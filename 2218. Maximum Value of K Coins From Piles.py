
import functools
import pysnooper
from typing import List
from copy import copy

class Solution:
    def maxValueOfCoins(self, piles: List[List[int]], k: int) -> int:
       
             
        @functools.lru_cache(maxsize=100000)
        def dp(i, k):
            if k == 0 or i == len(piles): return 0
            res, cur = dp(i + 1, k), 0
            for j in range(min(len(piles[i]), k)):
                cur += piles[i][j]
                res = max(res, cur + dp(i+1, k-j-1))
            return res
        
        return dp(0, k)
class Solution_dp:
    def maxValueOfCoins( self,piles:List[int] ,k:int)->int:
        pilesPreSum=[]
        dp=[]
        for pile_index,pile in enumerate(piles):
            pilesPreSum.append([])
            pilesPreSum[pile_index].append(0)
            for coin in pile:
                pilesPreSum[pile_index].append(pilesPreSum[pile_index][-1]+coin)
            dp.append([0]*(max(len(pile),k)+1))
        for pile_index,pile in enumerate(piles):
            for k_num in range(k+1):
                for coin_num in range( min(k_num,len(pile))+1):
                    if pile_index==0:
                        dp[pile_index][k_num]=max(dp[pile_index][k_num],pilesPreSum[pile_index][coin_num])
                    else:
                        dp[pile_index][k_num]=max(dp[pile_index][k_num],dp[pile_index-1][k_num-coin_num]+pilesPreSum[pile_index][coin_num])
        return dp[len(piles)-1][k]

if __name__=="__main__":
    instance_solution=Solution()
    ans=instance_solution.maxValueOfCoins([[1,100,3],[7,8,9]],2)
    print(ans)
    ans=instance_solution.maxValueOfCoins([[100],[100],[100],[100],[100],[100],[1,1,1,1,1,1,700]],7)
    print(ans)

    with pysnooper.snoop():
        ans=instance_solution.maxValueOfCoins( [[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000],[1,100000],[1],[100000,1],[100000]],
1000)
    print(ans)